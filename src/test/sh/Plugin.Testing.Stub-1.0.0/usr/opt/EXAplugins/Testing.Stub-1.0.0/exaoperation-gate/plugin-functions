#!/bin/bash

readonly script_path="$(dirname $(readlink -f $0))"

declare -A functions

functions[INSTALL]='Install plugin.'
functions[UNINSTALL]='Install plugin.'
functions[STATUS]='Show status of plugin (not installed, activated, not activated).'
functions[START]='Start plugin service'
functions[STOP]='Stop plugin service'
functions[RESTART]='Restart the service'
functions[ON_BOOT]='Undocumented'

usage() {
    echo "Usage: $0 <function name> <parameter>"
    echo "       $0 [--show-functions]"
}

exit_abnormal() {
    usage
    exit 1
}

list_functions() {
    for key in "${!functions[@]}"; do
        echo "$key:${functions[$key]}"
    done
}

if [[ "$#" -eq 1 ]]; then
    if [[ "$1" == '--show-functions' ]]; then
        list_functions
    else
        exit_abnormal
    fi
elif [[ "$#" -eq 2 ]]; then
    readonly given_function=${1^^}
    if [[ -n "${functions[$given_function]}" ]]; then
        "$script_path/${1,,}" "$2"
    else
        echo "Unknown plugin function name '$1'. Choose one of:"
        echo
        list_functions
        exit 1
    fi
else
    exit_abnormal
fi